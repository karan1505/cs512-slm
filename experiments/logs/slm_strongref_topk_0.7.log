Using device: cuda
Config: student=gpt2, ref=gpt2-medium, epochs=1, batch_size=2, select_ratio=0.7, selection=topk, seed=42
Loading WikiText-2...
Train blocks: 37354 Val blocks: 3862
Loading reference model: gpt2-medium
Loading student model from: gpt2
Starting SLM training with select_ratio = 0.7
Epoch 1 Step 100/18677 - SLM loss (selected tokens only): 4.3838
Epoch 1 Step 200/18677 - SLM loss (selected tokens only): 4.2550
Epoch 1 Step 300/18677 - SLM loss (selected tokens only): 4.1692
Epoch 1 Step 400/18677 - SLM loss (selected tokens only): 4.1493
Epoch 1 Step 500/18677 - SLM loss (selected tokens only): 4.1732
Epoch 1 Step 600/18677 - SLM loss (selected tokens only): 4.1839
Epoch 1 Step 700/18677 - SLM loss (selected tokens only): 4.1215
Epoch 1 Step 800/18677 - SLM loss (selected tokens only): 4.1265
Epoch 1 Step 900/18677 - SLM loss (selected tokens only): 4.1228
Epoch 1 Step 1000/18677 - SLM loss (selected tokens only): 4.1214
Epoch 1 Step 1100/18677 - SLM loss (selected tokens only): 4.1028
Epoch 1 Step 1200/18677 - SLM loss (selected tokens only): 4.0684
Epoch 1 Step 1300/18677 - SLM loss (selected tokens only): 4.0255
Epoch 1 Step 1400/18677 - SLM loss (selected tokens only): 3.9774
Epoch 1 Step 1500/18677 - SLM loss (selected tokens only): 4.0582
Epoch 1 Step 1600/18677 - SLM loss (selected tokens only): 4.0007
Epoch 1 Step 1700/18677 - SLM loss (selected tokens only): 4.0847
Epoch 1 Step 1800/18677 - SLM loss (selected tokens only): 4.0418
Epoch 1 Step 1900/18677 - SLM loss (selected tokens only): 4.0684
Epoch 1 Step 2000/18677 - SLM loss (selected tokens only): 4.0841
Epoch 1 Step 2100/18677 - SLM loss (selected tokens only): 4.0048
Epoch 1 Step 2200/18677 - SLM loss (selected tokens only): 4.0238
Epoch 1 Step 2300/18677 - SLM loss (selected tokens only): 3.9807
Epoch 1 Step 2400/18677 - SLM loss (selected tokens only): 4.0546
Epoch 1 Step 2500/18677 - SLM loss (selected tokens only): 4.0177
Epoch 1 Step 2600/18677 - SLM loss (selected tokens only): 4.0258
Epoch 1 Step 2700/18677 - SLM loss (selected tokens only): 4.0604
Epoch 1 Step 2800/18677 - SLM loss (selected tokens only): 4.0076
Epoch 1 Step 2900/18677 - SLM loss (selected tokens only): 3.9932
Epoch 1 Step 3000/18677 - SLM loss (selected tokens only): 4.0085
Epoch 1 Step 3100/18677 - SLM loss (selected tokens only): 3.9923
Epoch 1 Step 3200/18677 - SLM loss (selected tokens only): 3.9834
Epoch 1 Step 3300/18677 - SLM loss (selected tokens only): 4.0124
Epoch 1 Step 3400/18677 - SLM loss (selected tokens only): 3.9789
Epoch 1 Step 3500/18677 - SLM loss (selected tokens only): 3.9567
Epoch 1 Step 3600/18677 - SLM loss (selected tokens only): 3.9761
Epoch 1 Step 3700/18677 - SLM loss (selected tokens only): 3.9508
Epoch 1 Step 3800/18677 - SLM loss (selected tokens only): 3.9586
Epoch 1 Step 3900/18677 - SLM loss (selected tokens only): 3.9879
Epoch 1 Step 4000/18677 - SLM loss (selected tokens only): 4.0016
Epoch 1 Step 4100/18677 - SLM loss (selected tokens only): 3.9695
Epoch 1 Step 4200/18677 - SLM loss (selected tokens only): 3.9442
Epoch 1 Step 4300/18677 - SLM loss (selected tokens only): 3.9507
Epoch 1 Step 4400/18677 - SLM loss (selected tokens only): 3.9139
Epoch 1 Step 4500/18677 - SLM loss (selected tokens only): 3.9412
Epoch 1 Step 4600/18677 - SLM loss (selected tokens only): 4.0328
Epoch 1 Step 4700/18677 - SLM loss (selected tokens only): 4.0265
Epoch 1 Step 4800/18677 - SLM loss (selected tokens only): 4.0180
Epoch 1 Step 4900/18677 - SLM loss (selected tokens only): 3.9541
Epoch 1 Step 5000/18677 - SLM loss (selected tokens only): 4.0295
Epoch 1 Step 5100/18677 - SLM loss (selected tokens only): 3.9438
Epoch 1 Step 5200/18677 - SLM loss (selected tokens only): 3.9160
Epoch 1 Step 5300/18677 - SLM loss (selected tokens only): 3.9358
Epoch 1 Step 5400/18677 - SLM loss (selected tokens only): 3.9414
Epoch 1 Step 5500/18677 - SLM loss (selected tokens only): 4.0167
Epoch 1 Step 5600/18677 - SLM loss (selected tokens only): 3.9776
Epoch 1 Step 5700/18677 - SLM loss (selected tokens only): 3.9426
Epoch 1 Step 5800/18677 - SLM loss (selected tokens only): 3.9457
Epoch 1 Step 5900/18677 - SLM loss (selected tokens only): 3.9252
Epoch 1 Step 6000/18677 - SLM loss (selected tokens only): 3.9777
Epoch 1 Step 6100/18677 - SLM loss (selected tokens only): 3.8749
Epoch 1 Step 6200/18677 - SLM loss (selected tokens only): 3.9755
Epoch 1 Step 6300/18677 - SLM loss (selected tokens only): 3.9293
Epoch 1 Step 6400/18677 - SLM loss (selected tokens only): 3.9219
Epoch 1 Step 6500/18677 - SLM loss (selected tokens only): 3.8816
Epoch 1 Step 6600/18677 - SLM loss (selected tokens only): 3.8916
Epoch 1 Step 6700/18677 - SLM loss (selected tokens only): 3.8457
Epoch 1 Step 6800/18677 - SLM loss (selected tokens only): 3.9585
Epoch 1 Step 6900/18677 - SLM loss (selected tokens only): 3.8309
Epoch 1 Step 7000/18677 - SLM loss (selected tokens only): 4.0198
Epoch 1 Step 7100/18677 - SLM loss (selected tokens only): 3.9724
Epoch 1 Step 7200/18677 - SLM loss (selected tokens only): 3.9342
Epoch 1 Step 7300/18677 - SLM loss (selected tokens only): 3.8934
Epoch 1 Step 7400/18677 - SLM loss (selected tokens only): 3.9131
Epoch 1 Step 7500/18677 - SLM loss (selected tokens only): 3.9086
Epoch 1 Step 7600/18677 - SLM loss (selected tokens only): 3.9018
Epoch 1 Step 7700/18677 - SLM loss (selected tokens only): 3.9502
Epoch 1 Step 7800/18677 - SLM loss (selected tokens only): 4.0113
Epoch 1 Step 7900/18677 - SLM loss (selected tokens only): 3.9569
Epoch 1 Step 8000/18677 - SLM loss (selected tokens only): 3.8734
Epoch 1 Step 8100/18677 - SLM loss (selected tokens only): 3.9307
Epoch 1 Step 8200/18677 - SLM loss (selected tokens only): 3.8589
Epoch 1 Step 8300/18677 - SLM loss (selected tokens only): 3.9274
Epoch 1 Step 8400/18677 - SLM loss (selected tokens only): 3.9157
Epoch 1 Step 8500/18677 - SLM loss (selected tokens only): 3.8754
Epoch 1 Step 8600/18677 - SLM loss (selected tokens only): 3.9323
Epoch 1 Step 8700/18677 - SLM loss (selected tokens only): 3.9151
Epoch 1 Step 8800/18677 - SLM loss (selected tokens only): 3.9258
Epoch 1 Step 8900/18677 - SLM loss (selected tokens only): 3.9441
Epoch 1 Step 9000/18677 - SLM loss (selected tokens only): 3.8875
Epoch 1 Step 9100/18677 - SLM loss (selected tokens only): 3.9146
Epoch 1 Step 9200/18677 - SLM loss (selected tokens only): 3.9540
Epoch 1 Step 9300/18677 - SLM loss (selected tokens only): 3.9472
Epoch 1 Step 9400/18677 - SLM loss (selected tokens only): 3.9050
Epoch 1 Step 9500/18677 - SLM loss (selected tokens only): 3.8055
Epoch 1 Step 9600/18677 - SLM loss (selected tokens only): 3.8339
Epoch 1 Step 9700/18677 - SLM loss (selected tokens only): 3.8834
Epoch 1 Step 9800/18677 - SLM loss (selected tokens only): 3.8808
Epoch 1 Step 9900/18677 - SLM loss (selected tokens only): 3.9214
Epoch 1 Step 10000/18677 - SLM loss (selected tokens only): 3.8479
Epoch 1 Step 10100/18677 - SLM loss (selected tokens only): 3.8820
Epoch 1 Step 10200/18677 - SLM loss (selected tokens only): 3.8539
Epoch 1 Step 10300/18677 - SLM loss (selected tokens only): 3.8380
Epoch 1 Step 10400/18677 - SLM loss (selected tokens only): 3.8035
Epoch 1 Step 10500/18677 - SLM loss (selected tokens only): 3.8544
Epoch 1 Step 10600/18677 - SLM loss (selected tokens only): 3.9141
Epoch 1 Step 10700/18677 - SLM loss (selected tokens only): 3.8900
Epoch 1 Step 10800/18677 - SLM loss (selected tokens only): 3.8545
Epoch 1 Step 10900/18677 - SLM loss (selected tokens only): 3.9385
Epoch 1 Step 11000/18677 - SLM loss (selected tokens only): 3.9232
Epoch 1 Step 11100/18677 - SLM loss (selected tokens only): 3.8626
Epoch 1 Step 11200/18677 - SLM loss (selected tokens only): 3.8436
Epoch 1 Step 11300/18677 - SLM loss (selected tokens only): 3.9404
Epoch 1 Step 11400/18677 - SLM loss (selected tokens only): 3.9726
Epoch 1 Step 11500/18677 - SLM loss (selected tokens only): 3.9232
Epoch 1 Step 11600/18677 - SLM loss (selected tokens only): 3.8911
Epoch 1 Step 11700/18677 - SLM loss (selected tokens only): 3.9167
Epoch 1 Step 11800/18677 - SLM loss (selected tokens only): 3.8853
Epoch 1 Step 11900/18677 - SLM loss (selected tokens only): 3.8851
Epoch 1 Step 12000/18677 - SLM loss (selected tokens only): 3.8778
Epoch 1 Step 12100/18677 - SLM loss (selected tokens only): 3.8446
Epoch 1 Step 12200/18677 - SLM loss (selected tokens only): 3.8711
Epoch 1 Step 12300/18677 - SLM loss (selected tokens only): 3.8459
Epoch 1 Step 12400/18677 - SLM loss (selected tokens only): 3.8869
Epoch 1 Step 12500/18677 - SLM loss (selected tokens only): 3.9678
Epoch 1 Step 12600/18677 - SLM loss (selected tokens only): 3.8328
Epoch 1 Step 12700/18677 - SLM loss (selected tokens only): 3.9119
Epoch 1 Step 12800/18677 - SLM loss (selected tokens only): 3.8095
Epoch 1 Step 12900/18677 - SLM loss (selected tokens only): 3.8977
Epoch 1 Step 13000/18677 - SLM loss (selected tokens only): 3.8842
Epoch 1 Step 13100/18677 - SLM loss (selected tokens only): 3.9017
Epoch 1 Step 13200/18677 - SLM loss (selected tokens only): 3.8734
Epoch 1 Step 13300/18677 - SLM loss (selected tokens only): 3.8366
Epoch 1 Step 13400/18677 - SLM loss (selected tokens only): 3.8409
Epoch 1 Step 13500/18677 - SLM loss (selected tokens only): 3.8417
Epoch 1 Step 13600/18677 - SLM loss (selected tokens only): 3.8324
Epoch 1 Step 13700/18677 - SLM loss (selected tokens only): 3.8408
Epoch 1 Step 13800/18677 - SLM loss (selected tokens only): 3.8473
Epoch 1 Step 13900/18677 - SLM loss (selected tokens only): 3.8972
Epoch 1 Step 14000/18677 - SLM loss (selected tokens only): 3.8396
Epoch 1 Step 14100/18677 - SLM loss (selected tokens only): 3.8459
Epoch 1 Step 14200/18677 - SLM loss (selected tokens only): 3.8007
Epoch 1 Step 14300/18677 - SLM loss (selected tokens only): 3.8418
Epoch 1 Step 14400/18677 - SLM loss (selected tokens only): 3.8971
Epoch 1 Step 14500/18677 - SLM loss (selected tokens only): 3.9317
Epoch 1 Step 14600/18677 - SLM loss (selected tokens only): 3.8531
Epoch 1 Step 14700/18677 - SLM loss (selected tokens only): 3.8360
Epoch 1 Step 14800/18677 - SLM loss (selected tokens only): 3.8885
Epoch 1 Step 14900/18677 - SLM loss (selected tokens only): 3.7552
Epoch 1 Step 15000/18677 - SLM loss (selected tokens only): 3.8730
Epoch 1 Step 15100/18677 - SLM loss (selected tokens only): 3.8804
Epoch 1 Step 15200/18677 - SLM loss (selected tokens only): 3.8072
Epoch 1 Step 15300/18677 - SLM loss (selected tokens only): 3.8413
Epoch 1 Step 15400/18677 - SLM loss (selected tokens only): 3.8959
Epoch 1 Step 15500/18677 - SLM loss (selected tokens only): 3.9690
Epoch 1 Step 15600/18677 - SLM loss (selected tokens only): 3.8169
Epoch 1 Step 15700/18677 - SLM loss (selected tokens only): 3.8451
Epoch 1 Step 15800/18677 - SLM loss (selected tokens only): 3.8573
Epoch 1 Step 15900/18677 - SLM loss (selected tokens only): 3.8343
Epoch 1 Step 16000/18677 - SLM loss (selected tokens only): 3.8526
Epoch 1 Step 16100/18677 - SLM loss (selected tokens only): 3.7861
Epoch 1 Step 16200/18677 - SLM loss (selected tokens only): 3.8123
Epoch 1 Step 16300/18677 - SLM loss (selected tokens only): 3.8482
Epoch 1 Step 16400/18677 - SLM loss (selected tokens only): 3.8380
Epoch 1 Step 16500/18677 - SLM loss (selected tokens only): 3.9026
Epoch 1 Step 16600/18677 - SLM loss (selected tokens only): 3.7977
Epoch 1 Step 16700/18677 - SLM loss (selected tokens only): 3.8031
Epoch 1 Step 16800/18677 - SLM loss (selected tokens only): 3.8414
Epoch 1 Step 16900/18677 - SLM loss (selected tokens only): 3.8443
Epoch 1 Step 17000/18677 - SLM loss (selected tokens only): 3.8648
Epoch 1 Step 17100/18677 - SLM loss (selected tokens only): 3.8854
Epoch 1 Step 17200/18677 - SLM loss (selected tokens only): 3.7652
Epoch 1 Step 17300/18677 - SLM loss (selected tokens only): 3.7628
Epoch 1 Step 17400/18677 - SLM loss (selected tokens only): 3.8714
Epoch 1 Step 17500/18677 - SLM loss (selected tokens only): 3.8355
Epoch 1 Step 17600/18677 - SLM loss (selected tokens only): 3.7715
Epoch 1 Step 17700/18677 - SLM loss (selected tokens only): 3.8168
Epoch 1 Step 17800/18677 - SLM loss (selected tokens only): 3.7835
Epoch 1 Step 17900/18677 - SLM loss (selected tokens only): 3.8806
Epoch 1 Step 18000/18677 - SLM loss (selected tokens only): 3.8186
Epoch 1 Step 18100/18677 - SLM loss (selected tokens only): 3.8381
Epoch 1 Step 18200/18677 - SLM loss (selected tokens only): 3.8084
Epoch 1 Step 18300/18677 - SLM loss (selected tokens only): 3.7743
Epoch 1 Step 18400/18677 - SLM loss (selected tokens only): 3.7879
Epoch 1 Step 18500/18677 - SLM loss (selected tokens only): 3.7946
Epoch 1 Step 18600/18677 - SLM loss (selected tokens only): 3.8797
End of epoch 1: val_loss (full tokens) = 3.8370, val_ppl = 46.39
SLM training complete.
